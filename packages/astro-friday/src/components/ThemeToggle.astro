---
import { ThemeSwitch } from 'astro-color-scheme'

---

<ThemeSwitch strategy="button">
  <!-- Due to control the time of the switch excute, -->
  <!-- use a button to trigger the theme switch by self -->
  <button id="header-theme-toggle-btn--callback" /><button
    id="header-theme-toggle-btn--trigger"
    class="i-lucide:sun dark:i-lucide:moon hoverable-text cursor-pointer"
    aria-label="Toggle Theme"
                                                   ></button>
</ThemeSwitch>

<script>
import type { WithViewTransitionState } from 'astro-view-transition-script'
import { withViewTransition } from 'astro-view-transition-script'
import config from 'virtual:astro-friday-config'
import { dynamic } from '../utils/appearance'

function task(state: WithViewTransitionState) {
  const callback = state.document.getElementById('header-theme-toggle-btn--callback')
  const trigger = state.document.getElementById('header-theme-toggle-btn--trigger')
  trigger?.addEventListener('click', (e) => {
    const isDark = state.document.documentElement.classList.contains('dark')
    ;({
      plain: () => callback?.click(),
      dynamic,
      // @ts-expect-error ignore
    }[config.appearance] ?? config.appearance)(e, { isDark: !isDark, toggle: () => callback?.click() })
  })
}

withViewTransition({
  initial: task,
  beforeSwap: task,
})
</script>
