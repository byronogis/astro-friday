---
import type { ProjectItem as ProjectItemType } from '../../types/index'
import config from 'virtual:astro-friday-config'
import ArticleTOC from '../../components/ArticleTOC.astro'
import ProjectItem from '../../components/ProjectItem.astro'
import DefaultLayout from '../../layouts/Default.astro'

const projects = config.projects

const categorizedProjects = projects?.reduce((acc, project) => {
  const category = project.category || 'Uncategorized'
  if (!acc[category]) {
    acc[category] = []
  }
  acc[category].push(project)
  return acc
}, {} as Record<string, ProjectItemType[]>)

const headings = Object.entries(categorizedProjects).map(([category, _projects]) => ({
  depth: 2,
  text: category,
  slug: category.toLowerCase().replace(/\s+/g, '-'),
}))
---

<DefaultLayout>
  <div class="mx-auto max-w-300">
  <ArticleTOC {headings} toc={config.post.toc} />

  {
    Object.entries(categorizedProjects || {}).map(([category, projects], _cidx) => (
      <div
        class=""
      >
        <div
          id={category.toLowerCase().replace(/\s+/g, '-')}
          class="mt5 h18 pointer-events-none select-none relative"
        >
          <span
            class="text-5em stroke-text-1.5 leading-1em op35 left--1rem top-0rem absolute dark:op20"
          >{category}</span>
        </div>
        <div
          class="mx-auto py-2 gap-4 grid grid-cols-1 max-w-500 w-max lg:grid-cols-3 md:grid-cols-2"
        >
          {projects.map(project => (
            <ProjectItem {project} />
          ))}
        </div>
      </div>
    ))
  }
  </div>
</DefaultLayout>



