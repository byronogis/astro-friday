---
import NProgress from 'astro-nprogress/component'
import { ClientRouter } from 'astro:transitions'
import config from 'virtual:astro-friday-config'
import Art from '../components/Art/Art.astro'
import CodeBlockWrapper from '../components/CodeBlockWrapper.astro'
import HeadContent from '../components/HeadContent.astro'
import 'virtual:astro-friday-unocss-extract'
import '../styles/index.css'

interface Props {
  seo?: import('astro-seo').Props
}

const { seo } = Astro.props

---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <HeadContent {seo} />
    <CodeBlockWrapper />

    {config.viewTransition.enable && <ClientRouter />}

    <style is:global>
      :root.dark img {
        filter: brightness(0.8) saturate(1.25);
      }
    </style>
  </head>
  <body class="text-gray-700 font-sans relative dark:text-gray-200">
    <slot />
    <Art />
    { config.viewTransition.enable && config.integrations.nprogress ? <NProgress /> : null }
  </body>
</html>

<script>
import { withViewTransition } from 'astro-view-transition-script'

/**
 * @see https://github.com/withastro/astro/issues/10615#issuecomment-3289385496
 */
withViewTransition({
  beforeSwap(state, e) {
    state.document.documentElement.style.scrollBehavior
      = e.navigationType === 'traverse' ? 'auto' : 'smooth'
  },
  done(state) {
    state.document.documentElement.style.scrollBehavior = 'smooth'
  },
})
</script>
